<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Signup</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/public/style.css">
</head>

<body>
  <div class="auth-wrap">
    <div class="auth-card">
      <div class="auth-title">Create Account</div>

      <form id="signupForm">
        <div class="auth-grid">

          <div>
            <div class="auth-label">Username</div>
            <input class="auth-input" name="username" placeholder="Enter username" required />
          </div>

          <div>
            <div class="auth-label">Sport</div>
            <select class="auth-select" name="sport" required>
              <option value="">Choose a sport</option>
              <option value="Hockey">Hockey</option>
              <option value="Figure Skating">Figure Skating</option>
              <option value="Skiing">Skiing</option>
              <option value="Snowboarding">Snowboarding</option>
              <option value="Speed Skating">Speed Skating</option>
              <option value="Curling">Curling</option>
              <option value="Bobsleigh">Bobsleigh</option>
              <option value="Luge">Luge</option>
            </select>
          </div>

          <div>
            <div class="auth-label">First Name</div>
            <input class="auth-input" name="forename" placeholder="Enter first name" required />
          </div>

          <div>
            <div class="auth-label">Last Name</div>
            <input class="auth-input" name="surname" placeholder="Enter last name" required />
          </div>

          <div>
            <div class="auth-label">Create Password</div>
            <input class="auth-input" type="password" name="pass" placeholder="Create password" required />
          </div>

          <div>
            <div class="auth-label">Confirm Password</div>
            <input class="auth-input" type="password" name="confirmPassword" placeholder="Confirm password" required />
          </div>

        </div>


        <div class="auth-row-center">
          <label class="auth-check">
            <input type="checkbox" id="termsCheck" required />
            <span>I Agree To <a href="#" onclick="return false;">The Terms &amp; Conditions</a></span>
          </label>
        </div>


        <div class="auth-btn-row">
          <button class="auth-btn" type="submit">GET STARTED</button>
        </div>

        <div id="msg" class="auth-msg"></div>
      </form>
    </div>
  </div>

  <script>
  const form = document.getElementById("signupForm");
  const msg = document.getElementById("msg");

  function showMsg(text, ok) {
    msg.textContent = text;
    msg.style.color = ok ? "green" : "crimson";
  }

  // Handle form submission

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const data = Object.fromEntries(new FormData(form).entries());

    if (data.pass !== data.confirmPassword) {
      showMsg("Passwords do not match.", false);
      return;
    }

    
    delete data.confirmPassword;

    try {
      const res = await fetch("/api/signup", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      const result = await res.json();


      // Check for errors if there is a unsuccessful response

      if (!res.ok) {
        showMsg(result.message || "Signup failed.", false);
        return;
      }

      // Signup successful, show message and redirect after a delay 
      console.log("Signup success. Redirecting in 5 seconds...");

      showMsg("Signup successful! Redirecting in 5 seconds...", true);

      setTimeout(() => {
        console.log("Redirecting now...");
        window.location.assign("/");
      }, 5000);

    } catch (err) {
      showMsg("Network error: " + err.message, false);
    }
  });
</script>

</body>
</html>
